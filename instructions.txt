Install : 

- Create docker repositories

- Create docker images and push them to the repositories
  -> docker build ../.. -f Dockerfile --no-cache -t maximilienbey/movie-app_movie
  -> docker push maximilienbey/movie-app_movie

- Install the helm chart
  -> cd helm/movie-app
  -> helm dependency update
  -> helm install movie-app .

- Expose the service
  -> kubectl expose deployment auth --type='NodePort' --port=3000

- Create a Google Cluster
  -> gcloud container clusters create movie-app \
      --disk-type=pd-standard \
      --disk-size=50

- Setting up Workload Identity on GKE
  -> gcloud container clusters update YOUR_CLUSTER_NAME \
      --workload-pool=PROJECT_ID.svc.id.goog \
  -> gcloud iam service-accounts create GSA_NAME \
      --project=PROJECT_ID
  -> kubectl create serviceaccount KSA_NAME --namespace default
  -> gcloud iam service-accounts add-iam-policy-binding GSA_NAME@PROJECT_ID.iam.gserviceaccount.com \
      --role roles/iam.workloadIdentityUser \
      --member "serviceAccount:PROJECT_ID.svc.id.goog[default/KSA_NAME]"
  -> kubectl annotate serviceaccount KSA_NAME \
      --namespace YOUR_NAMESPACE \
      iam.gke.io/gcp-service-account=GSA_NAME@PROJECT_ID.iam.gserviceaccount.com

- Assigning IAM Roles to a Google Service Account
  -> gcloud projects add-iam-policy-binding PROJECT_ID \
    --member="serviceAccount:GSA_NAME@PROJECT_ID.iam.gserviceaccount.com" \
    --role="roles/compute.loadBalancerAdmin"

- Apply ingress
  -> kubectl apply -f templates/ingress.yaml

- Install application
  -> helm install movie-app .
